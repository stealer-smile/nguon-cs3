name: Sync Repos

on:
  schedule:
    - cron: '0 0 * * 0' # Chạy mỗi tuần một lần
  workflow_dispatch: # Cho phép chạy thủ công

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository (repo nguồn)
        uses: actions/checkout@v2
        with:
          persist-credentials: false
          fetch-depth: 0
          ref: builds-2  # Checkout nhánh builds-2 từ repo nguồn

      - name: Set up Git
        run: |
          git config user.name "GitHub Actions"
          git config user.email "actions@github.com"

      - name: Add upstream repository (repo đích)
        run: git remote add destination https://github.com/stealer-smile/extension.git

      - name: Fetch destination repo
        run: git fetch destination

      - name: Merge changes from source to destination
        run: |
          git checkout builds-2
          git merge destination/builds-2 --ff-only || echo "No changes to merge"

      - name: Push changes to destination repo builds-2
        env:
          GITHUB_TOKEN: ${{ secrets.TOKEN }}  # Sử dụng token để đẩy code lên repository đích
        run: |
          git remote set-url destination https://oauth2:${{ secrets.TOKEN }}@github.com/stealer-smile/extension.git
          git push destination builds-2 --force
